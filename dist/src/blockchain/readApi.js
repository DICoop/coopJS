import EosApi from 'eosjs-api';
import ono from '@jsdevtools/ono';
import { RpcEndpointsEmptyError } from './errors';
class ReadApi {
    constructor(chainName, apiConfigs, balancingMode) {
        this.getKeyAccounts = (...args) => {
            const instance = this.getInstance();
            return instance.getKeyAccounts(...args);
        };
        this.getAccount = (...args) => {
            const instance = this.getInstance();
            return instance.getAccount(...args);
        };
        this.getAbi = (...args) => {
            const instance = this.getInstance();
            return instance.getAbi(...args);
        };
        this.getCurrencyBalance = (...args) => {
            const instance = this.getInstance();
            return instance.getCurrencyBalance(...args);
        };
        this.offset = 0;
        this.balancingMode = balancingMode || 'random-once';
        this.apis = [];
        this.endpoints = [];
        if (!apiConfigs || apiConfigs.length === 0) {
            throw ono(new RpcEndpointsEmptyError(`rpcEndpoints is empty (chain=${chainName})`));
        }
        for (const { protocol, host, port } of apiConfigs) {
            const rpcEndpointString = `${protocol}://${host}:${port}`;
            this.endpoints.push(rpcEndpointString);
            this.apis.push(new EosApi({ httpEndpoint: rpcEndpointString }));
        }
        if (this.balancingMode === 'random-once' && this.apis.length > 1) {
            this.offset = Math.floor(Math.random() * this.apis.length);
        }
    }
    getBalancedItemByOffset(currentOffset, items, balancingMode) {
        if (items.length < 2) {
            return {
                result: items[0],
                offset: 0,
            };
        }
        let nextOffset = currentOffset;
        if (balancingMode === 'random') {
            nextOffset = Math.floor(Math.random() * items.length);
        }
        const instance = items[nextOffset];
        if (balancingMode === 'round-robin') {
            nextOffset++;
            if (nextOffset >= items.length) {
                nextOffset = 0;
            }
        }
        return {
            result: instance,
            offset: nextOffset,
        };
    }
    getBalancedItem(collection) {
        const { result, offset, } = this.getBalancedItemByOffset(this.offset, collection, this.balancingMode);
        this.offset = offset;
        return result;
    }
    getInstance() {
        return this.getBalancedItem(this.apis);
    }
    getEndpoint() {
        return this.getBalancedItem(this.endpoints);
    }
    async getUserBalance(account, symbol) {
        const [balance] = await this.getCurrencyBalance("eosio.token", account, symbol);
        return `${(parseFloat(balance || '0') || 0).toFixed(4)} ${symbol}`;
    }
    async getPermissionKeyByName(accountName, name) {
        const account = await this.getAccount(accountName);
        const permission = account.permissions.find(el => el.perm_name === name);
        return permission?.required_auth.keys[0].key;
    }
    async getInfo(accountName, name) {
        const account = await this.getAccount(accountName);
        const permission = account.permissions.find(el => el.perm_name === name);
        return permission?.required_auth.keys[0].key;
    }
    getTableRows(code, scope, table, table_key, lower_bound, upper_bound, limit, key_type, index_position) {
        const instance = this.getInstance();
        return instance.getTableRows(true, code, scope, table, table_key, lower_bound, upper_bound, limit, key_type, index_position);
    }
}
export default ReadApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhZEFwaS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzL3NyYy9ibG9ja2NoYWluL3JlYWRBcGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxNQUFNLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sR0FBRyxNQUFNLGlCQUFpQixDQUFBO0FBR2pDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQU9qRCxNQUFNLE9BQU87SUFNWCxZQUFZLFNBQWlCLEVBQUUsVUFBeUIsRUFBRSxhQUE2QjtRQXFFdkYsbUJBQWMsR0FBNkIsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1lBQ3JELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUVuQyxPQUFPLFFBQVEsQ0FBQyxjQUFjLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUN6QyxDQUFDLENBQUE7UUFFRCxlQUFVLEdBQXlCLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtZQUM3QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7WUFFbkMsT0FBTyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDckMsQ0FBQyxDQUFBO1FBRUQsV0FBTSxHQUFxQixDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUU7WUFDckMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBRW5DLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2pDLENBQUMsQ0FBQTtRQUVELHVCQUFrQixHQUFpQyxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUU7WUFDN0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBRW5DLE9BQU8sUUFBUSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDN0MsQ0FB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QyxZQUFZLENBQzFCLElBQUksRUFDSixJQUFJLEVBQ0osS0FBSyxFQUNMLEtBQUssRUFDTCxTQUFTLEVBQ1QsV0FBVyxFQUNYLFdBQVcsRUFDWCxLQUFLLEVBQ0wsUUFBUSxFQUNSLGNBQWMsQ0FDZixDQUFBO0lBQ0gsQ0FBQztDQUNGO0FBRUQsZUFBZSxPQUFPLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRW9zQXBpIGZyb20gJ2Vvc2pzLWFwaSdcbmltcG9ydCBvbm8gZnJvbSAnQGpzZGV2dG9vbHMvb25vJ1xuXG5pbXBvcnQgeyBScGNFbmRwb2ludCwgQmFsYW5jaW5nTW9kZSB9IGZyb20gJy4vdHlwZXMnXG5pbXBvcnQgeyBScGNFbmRwb2ludHNFbXB0eUVycm9yIH0gZnJvbSAnLi9lcnJvcnMnXG5cbmludGVyZmFjZSBCYWxhbmNpbmdSZXN1bHQ8VD4ge1xuICByZXN1bHQ6IFQsXG4gIG9mZnNldDogbnVtYmVyLFxufVxuXG5jbGFzcyBSZWFkQXBpIHtcbiAgcHJpdmF0ZSByZWFkb25seSBiYWxhbmNpbmdNb2RlOiBCYWxhbmNpbmdNb2RlXG4gIHByaXZhdGUgcmVhZG9ubHkgYXBpczogRW9zQXBpW11cbiAgcHJpdmF0ZSByZWFkb25seSBlbmRwb2ludHM6IHN0cmluZ1tdXG4gIHByaXZhdGUgb2Zmc2V0OiBudW1iZXJcblxuICBjb25zdHJ1Y3RvcihjaGFpbk5hbWU6IHN0cmluZywgYXBpQ29uZmlnczogUnBjRW5kcG9pbnRbXSwgYmFsYW5jaW5nTW9kZT86IEJhbGFuY2luZ01vZGUpIHtcbiAgICB0aGlzLm9mZnNldCA9IDBcbiAgICB0aGlzLmJhbGFuY2luZ01vZGUgPSBiYWxhbmNpbmdNb2RlIHx8ICdyYW5kb20tb25jZSdcbiAgICB0aGlzLmFwaXMgPSBbXVxuICAgIHRoaXMuZW5kcG9pbnRzID0gW11cblxuICAgIGlmICghYXBpQ29uZmlncyB8fCBhcGlDb25maWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgb25vKG5ldyBScGNFbmRwb2ludHNFbXB0eUVycm9yKGBycGNFbmRwb2ludHMgaXMgZW1wdHkgKGNoYWluPSR7Y2hhaW5OYW1lfSlgKSlcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHsgcHJvdG9jb2wsIGhvc3QsIHBvcnQgfSBvZiBhcGlDb25maWdzKSB7XG4gICAgICBjb25zdCBycGNFbmRwb2ludFN0cmluZyA9IGAke3Byb3RvY29sfTovLyR7aG9zdH06JHtwb3J0fWBcbiAgICAgIHRoaXMuZW5kcG9pbnRzLnB1c2gocnBjRW5kcG9pbnRTdHJpbmcpXG4gICAgICB0aGlzLmFwaXMucHVzaChuZXcgRW9zQXBpKHsgaHR0cEVuZHBvaW50OiBycGNFbmRwb2ludFN0cmluZyB9KSlcbiAgICB9XG5cbiAgICBpZiAodGhpcy5iYWxhbmNpbmdNb2RlID09PSAncmFuZG9tLW9uY2UnICYmIHRoaXMuYXBpcy5sZW5ndGggPiAxKSB7XG4gICAgICB0aGlzLm9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuYXBpcy5sZW5ndGgpXG4gICAgfVxuICB9XG5cbiAgZ2V0QmFsYW5jZWRJdGVtQnlPZmZzZXQ8VD4oY3VycmVudE9mZnNldDogbnVtYmVyLCBpdGVtczogVFtdLCBiYWxhbmNpbmdNb2RlOiBCYWxhbmNpbmdNb2RlKTogQmFsYW5jaW5nUmVzdWx0PFQ+IHtcbiAgICBpZiAoaXRlbXMubGVuZ3RoIDwgMikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdWx0OiBpdGVtc1swXSxcbiAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBuZXh0T2Zmc2V0ID0gY3VycmVudE9mZnNldFxuICAgIGlmIChiYWxhbmNpbmdNb2RlID09PSAncmFuZG9tJykge1xuICAgICAgbmV4dE9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGl0ZW1zLmxlbmd0aClcbiAgICB9XG5cbiAgICBjb25zdCBpbnN0YW5jZSA9IGl0ZW1zW25leHRPZmZzZXRdXG5cbiAgICBpZiAoYmFsYW5jaW5nTW9kZSA9PT0gJ3JvdW5kLXJvYmluJykge1xuICAgICAgbmV4dE9mZnNldCsrXG5cbiAgICAgIGlmIChuZXh0T2Zmc2V0ID49IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICBuZXh0T2Zmc2V0ID0gMFxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICByZXN1bHQ6IGluc3RhbmNlLFxuICAgICAgb2Zmc2V0OiBuZXh0T2Zmc2V0LFxuICAgIH1cbiAgfVxuXG4gIGdldEJhbGFuY2VkSXRlbTxUPihjb2xsZWN0aW9uOiBUW10pOiBUIHtcbiAgICBjb25zdCB7XG4gICAgICByZXN1bHQsXG4gICAgICBvZmZzZXQsXG4gICAgfSA9IHRoaXMuZ2V0QmFsYW5jZWRJdGVtQnlPZmZzZXQ8VD4odGhpcy5vZmZzZXQsIGNvbGxlY3Rpb24sIHRoaXMuYmFsYW5jaW5nTW9kZSlcblxuICAgIHRoaXMub2Zmc2V0ID0gb2Zmc2V0XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cblxuICBnZXRJbnN0YW5jZSgpOiBFb3NBcGkge1xuICAgIHJldHVybiB0aGlzLmdldEJhbGFuY2VkSXRlbTxFb3NBcGk+KHRoaXMuYXBpcylcbiAgfVxuXG4gIGdldEVuZHBvaW50KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QmFsYW5jZWRJdGVtPHN0cmluZz4odGhpcy5lbmRwb2ludHMpXG4gIH1cblxuICBnZXRLZXlBY2NvdW50czogRW9zQXBpWydnZXRLZXlBY2NvdW50cyddID0gKC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0SW5zdGFuY2UoKVxuXG4gICAgcmV0dXJuIGluc3RhbmNlLmdldEtleUFjY291bnRzKC4uLmFyZ3MpXG4gIH1cblxuICBnZXRBY2NvdW50OiBFb3NBcGlbJ2dldEFjY291bnQnXSA9ICguLi5hcmdzKSA9PiB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldEluc3RhbmNlKClcblxuICAgIHJldHVybiBpbnN0YW5jZS5nZXRBY2NvdW50KC4uLmFyZ3MpXG4gIH1cblxuICBnZXRBYmk6IEVvc0FwaVsnZ2V0QWJpJ10gPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRJbnN0YW5jZSgpXG5cbiAgICByZXR1cm4gaW5zdGFuY2UuZ2V0QWJpKC4uLmFyZ3MpXG4gIH1cblxuICBnZXRDdXJyZW5jeUJhbGFuY2U6IEVvc0FwaVsnZ2V0Q3VycmVuY3lCYWxhbmNlJ10gPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRJbnN0YW5jZSgpXG5cbiAgICByZXR1cm4gaW5zdGFuY2UuZ2V0Q3VycmVuY3lCYWxhbmNlKC4uLmFyZ3MpXG4gIH1cblxuICBhc3luYyBnZXRVc2VyQmFsYW5jZShhY2NvdW50OiBzdHJpbmcsIHN5bWJvbDogc3RyaW5nKSB7XG4gICAgY29uc3QgW2JhbGFuY2VdID0gYXdhaXQgdGhpcy5nZXRDdXJyZW5jeUJhbGFuY2UoXCJlb3Npby50b2tlblwiLCBhY2NvdW50LCBzeW1ib2wpXG5cbiAgICByZXR1cm4gYCR7KHBhcnNlRmxvYXQoYmFsYW5jZSB8fCAnMCcpIHx8IDApLnRvRml4ZWQoNCl9ICR7c3ltYm9sfWBcbiAgfVxuXG4gIGFzeW5jIGdldFBlcm1pc3Npb25LZXlCeU5hbWUoYWNjb3VudE5hbWU6IHN0cmluZywgbmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgYWNjb3VudCA9IGF3YWl0IHRoaXMuZ2V0QWNjb3VudChhY2NvdW50TmFtZSk7XG4gICAgY29uc3QgcGVybWlzc2lvbiA9IGFjY291bnQucGVybWlzc2lvbnMuZmluZChlbCA9PiBlbC5wZXJtX25hbWUgPT09IG5hbWUpXG5cbiAgICByZXR1cm4gcGVybWlzc2lvbj8ucmVxdWlyZWRfYXV0aC5rZXlzWzBdLmtleVxuICB9XG5cbiAgYXN5bmMgZ2V0SW5mbyhhY2NvdW50TmFtZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgdGhpcy5nZXRBY2NvdW50KGFjY291bnROYW1lKTtcbiAgICBjb25zdCBwZXJtaXNzaW9uID0gYWNjb3VudC5wZXJtaXNzaW9ucy5maW5kKGVsID0+IGVsLnBlcm1fbmFtZSA9PT0gbmFtZSlcblxuICAgIHJldHVybiBwZXJtaXNzaW9uPy5yZXF1aXJlZF9hdXRoLmtleXNbMF0ua2V5XG4gIH1cblxuXG4gIGdldFRhYmxlUm93czxSb3dUeXBlPihcbiAgICBjb2RlOiBzdHJpbmcsXG4gICAgc2NvcGU6IHN0cmluZyxcbiAgICB0YWJsZTogc3RyaW5nLFxuICAgIHRhYmxlX2tleT86IHN0cmluZyxcbiAgICBsb3dlcl9ib3VuZD86IG51bWJlciB8IHN0cmluZyxcbiAgICB1cHBlcl9ib3VuZD86IG51bWJlciB8IHN0cmluZyxcbiAgICBsaW1pdD86IG51bWJlcixcbiAgICBrZXlfdHlwZT86IHN0cmluZyxcbiAgICBpbmRleF9wb3NpdGlvbj86IG51bWJlclxuICApIHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0SW5zdGFuY2UoKVxuXG4gICAgcmV0dXJuIGluc3RhbmNlLmdldFRhYmxlUm93czxSb3dUeXBlPihcbiAgICAgIHRydWUsXG4gICAgICBjb2RlLFxuICAgICAgc2NvcGUsXG4gICAgICB0YWJsZSxcbiAgICAgIHRhYmxlX2tleSxcbiAgICAgIGxvd2VyX2JvdW5kLFxuICAgICAgdXBwZXJfYm91bmQsXG4gICAgICBsaW1pdCxcbiAgICAgIGtleV90eXBlLFxuICAgICAgaW5kZXhfcG9zaXRpb25cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVhZEFwaVxuIl19