import BaseContract from './base';
class NftContract extends BaseContract {
    constructor(api, tableCodeConfig) {
        super(api, tableCodeConfig, 'nft');
    }
    async getObjectsByOwner(owner) {
        const q = {
            table: 'pieces',
            lower_bound: owner,
            upper_bound: owner,
            limit: 1000,
            index_position: 2,
            key_type: 'i64',
            getAllRows: true,
            parseMetaAsJson: true,
            parseKeysAsJson: ['images'],
            defaultJsonValues: {
                images: () => [],
            },
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async getAllObjects() {
        const q = {
            table: 'objects',
            limit: 100,
            lower_bound: 0,
            getAllRows: true,
            parseMetaAsJson: true,
            parseKeysAsJson: ['images'],
            defaultJsonValues: {
                images: () => [],
            },
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async getObjectsById(id) {
        const q = {
            table: 'objects',
            limit: 1,
            lower_bound: id,
            upper_bound: id,
            index_position: 0,
            key_type: 'i64',
            parseMetaAsJson: true,
            parseKeysAsJson: ['images'],
            defaultJsonValues: {
                images: () => [],
            },
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async getMarket() {
        const q = {
            table: 'market',
            limit: 1000,
            lower_bound: 0,
            getAllRows: true,
            parseMetaAsJson: true,
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async getMarketObjectsById(id) {
        const q = {
            table: 'market',
            limit: 1,
            lower_bound: id,
            upper_bound: id,
            index_position: 0,
            key_type: 'i64',
            parseMetaAsJson: true,
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async fetchRequestsWithIndexPosition(username, indexPosition) {
        const q = {
            table: 'requests',
            lower_bound: username,
            upper_bound: username,
            limit: 1000,
            index_position: indexPosition,
            key_type: 'i64',
            parseKeysAsJson: ['delivery_to', 'meta'],
            getAllRows: true,
        };
        const { rows } = await this.getTableRows(q);
        return rows;
    }
    async fetchRequests(username) {
        const [asBuyer, asSeller] = await Promise.all([
            this.fetchRequestsWithIndexPosition(username, 2),
            this.fetchRequestsWithIndexPosition(username, 3),
        ]);
        return [...asBuyer, ...asSeller];
    }
}
export default NftContract;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmZ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdHMvc3JjL2Jsb2NrY2hhaW4vY29udHJhY3RzL25mdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxPQUFPLFlBQTZCLE1BQU0sUUFBUSxDQUFBO0FBMkRsRCxNQUFNLFdBQVksU0FBUSxZQUFZO0lBQ3BDLFlBQVksR0FBWSxFQUFFLGVBQWdDO1FBQ3hELEtBQUssQ0FBQyxHQUFHLEVBQUUsZUFBZSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3BDLENBQUM7SUFFRCxLQUFLLENBQUMsaUJBQWlCLENBQUMsS0FBa0I7UUFDeEMsTUFBTSxDQUFDLEdBQWtCO1lBQ3ZCLEtBQUssRUFBRSxRQUFRO1lBQ2YsV0FBVyxFQUFFLEtBQUs7WUFDbEIsV0FBVyxFQUFFLEtBQUs7WUFDbEIsS0FBSyxFQUFFLElBQUk7WUFDWCxjQUFjLEVBQUUsQ0FBQztZQUNqQixRQUFRLEVBQUUsS0FBSztZQUNmLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQztZQUMzQixpQkFBaUIsRUFBRTtnQkFDakIsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUU7YUFDakI7U0FDRixDQUFBO1FBQ0QsTUFBTSxFQUFDLElBQUksRUFBQyxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBWSxDQUFDLENBQUMsQ0FBQTtRQUVwRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxLQUFLLENBQUMsYUFBYTtRQUNqQixNQUFNLENBQUMsR0FBa0I7WUFDdkIsS0FBSyxFQUFFLFNBQVM7WUFDaEIsS0FBSyxFQUFFLEdBQUc7WUFDVixXQUFXLEVBQUUsQ0FBQztZQUNkLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQztZQUMzQixpQkFBaUIsRUFBRTtnQkFDakIs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Y2NvdW50TmFtZSB9IGZyb20gJy4uLy4uL2Vvcy90eXBlcydcbmltcG9ydCBSZWFkQXBpIGZyb20gJy4uL3JlYWRBcGknXG5pbXBvcnQgeyBUYWJsZUNvZGVDb25maWcgfSBmcm9tICcuLi90eXBlcydcbmltcG9ydCBCYXNlQ29udHJhY3QsIHtUYWJsZVJvd3NBcmdzfSBmcm9tICcuL2Jhc2UnXG5cbmV4cG9ydCBpbnRlcmZhY2UgTmZ0T2JqZWN0IHtcbiAgY2F0ZWdvcnk6IHN0cmluZ1xuICBjcmVhdG9yOiBzdHJpbmdcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICBpZDogbnVtYmVyXG4gIGltYWdlczogc3RyaW5nW11cbiAgaXBuczogc3RyaW5nXG4gIG1ldGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICB0aXRsZTogc3RyaW5nXG4gIHRvdGFsX3BpZWNlczogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVsaXZlcnlSZXF1ZXN0IHtcbiAgdHlwZTogc3RyaW5nXG4gIHBsYWNlaG9sZGVyOiBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgRGVsaXZlcnlSZXF1ZXN0RmlsbGVkID0gRGVsaXZlcnlSZXF1ZXN0ICYge1xuICB2YWx1ZTogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTmZ0TWFya2V0T2JqZWN0IHtcbiAgYmFzZV9waWVjZV9wcmljZTogc3RyaW5nXG4gIGJsb2NrZWRfcGllY2VzOiBudW1iZXJcbiAgZGF5X2ZpbmlzaDogbnVtYmVyXG4gIGRheV9zdGFydDogbnVtYmVyXG4gIGlkOiBudW1iZXJcbiAgbWV0YToge2RlbGl2ZXJ5X3JlcXVlc3Q6IERlbGl2ZXJ5UmVxdWVzdFtdfVxuICBtaW5fcGllY2VfcHJpY2U6IHN0cmluZ1xuICBvYmplY3RfaWQ6IG51bWJlclxuICByZW1haW5fcGllY2VzOiBudW1iZXJcbiAgc2FsZXNfY2xvc2VkX2F0OiBzdHJpbmdcbiAgc2FsZXNfc3RhcnRfYXQ6IHN0cmluZ1xuICBzZWxsZXI6IHN0cmluZ1xuICBzdGF0dXM6IFwid2FpdGluZ1wiIHwgXCJwYXVzZVwiXG4gIHRva2VuX2NvbnRyYWN0OiBzdHJpbmdcbiAgdG90YWxfcHJpY2U6IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE5mdE1hcmtldFJlcXVlc3Qge1xuICBpZDogbnVtYmVyXG4gIG1hcmtldF9pZDogbnVtYmVyXG4gIGJ1eWVyOiBzdHJpbmdcbiAgc2VsbGVyOiBzdHJpbmdcbiAgbWFuYWdlcjogc3RyaW5nXG4gIHJlcXVlc3RlZF9waWVjZXM6IG51bWJlclxuICB0b3RhbF9wcmljZTogc3RyaW5nXG4gIGJhc2VfcGllY2VfcHJpY2U6IHN0cmluZ1xuICBvbmVfcGllY2VfcHJpY2U6IHN0cmluZ1xuICB0b3RhbF9wYXllZDogc3RyaW5nXG4gIHN0YXR1czogXCJ3YWl0aW5nXCIgfCBcImFjY2VwdGVkXCIgfCBcImNvbmZpcm1lZFwiIHwgXCJpc3N1ZWRcIiB8IFwiZGVjbGluZWRcIiB8IFwiY2FuY2VsbGVkXCIgfCBcImNvbXBsZXRlZFwiXG4gIGRheV9zdGFydDogbnVtYmVyXG4gIGRheV9maW5pc2g6IG51bWJlclxuICBkZWxpdmVyeV90bzogRGVsaXZlcnlSZXF1ZXN0RmlsbGVkW11cbiAgbWV0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbn1cblxuY2xhc3MgTmZ0Q29udHJhY3QgZXh0ZW5kcyBCYXNlQ29udHJhY3Qge1xuICBjb25zdHJ1Y3RvcihhcGk6IFJlYWRBcGksIHRhYmxlQ29kZUNvbmZpZzogVGFibGVDb2RlQ29uZmlnKSB7XG4gICAgc3VwZXIoYXBpLCB0YWJsZUNvZGVDb25maWcsICduZnQnKVxuICB9XG5cbiAgYXN5bmMgZ2V0T2JqZWN0c0J5T3duZXIob3duZXI6IEFjY291bnROYW1lKSB7XG4gICAgY29uc3QgcTogVGFibGVSb3dzQXJncyA9IHtcbiAgICAgIHRhYmxlOiAncGllY2VzJyxcbiAgICAgIGxvd2VyX2JvdW5kOiBvd25lcixcbiAgICAgIHVwcGVyX2JvdW5kOiBvd25lcixcbiAgICAgIGxpbWl0OiAxMDAwLFxuICAgICAgaW5kZXhfcG9zaXRpb246IDIsXG4gICAgICBrZXlfdHlwZTogJ2k2NCcsXG4gICAgICBnZXRBbGxSb3dzOiB0cnVlLFxuICAgICAgcGFyc2VNZXRhQXNKc29uOiB0cnVlLFxuICAgICAgcGFyc2VLZXlzQXNKc29uOiBbJ2ltYWdlcyddLFxuICAgICAgZGVmYXVsdEpzb25WYWx1ZXM6IHtcbiAgICAgICAgaW1hZ2VzOiAoKSA9PiBbXSxcbiAgICAgIH0sXG4gICAgfVxuICAgIGNvbnN0IHtyb3dzfSA9IGF3YWl0IHRoaXMuZ2V0VGFibGVSb3dzPE5mdE9iamVjdD4ocSlcblxuICAgIHJldHVybiByb3dzO1xuICB9XG5cbiAgYXN5bmMgZ2V0QWxsT2JqZWN0cygpIHtcbiAgICBjb25zdCBxOiBUYWJsZVJvd3NBcmdzID0ge1xuICAgICAgdGFibGU6ICdvYmplY3RzJyxcbiAgICAgIGxpbWl0OiAxMDAsXG4gICAgICBsb3dlcl9ib3VuZDogMCxcbiAgICAgIGdldEFsbFJvd3M6IHRydWUsXG4gICAgICBwYXJzZU1ldGFBc0pzb246IHRydWUsXG4gICAgICBwYXJzZUtleXNBc0pzb246IFsnaW1hZ2VzJ10sXG4gICAgICBkZWZhdWx0SnNvblZhbHVlczoge1xuICAgICAgICBpbWFnZXM6ICgpID0+IFtdLFxuICAgICAgfSxcbiAgICB9XG4gICAgY29uc3Qge3Jvd3N9ID0gYXdhaXQgdGhpcy5nZXRUYWJsZVJvd3M8TmZ0T2JqZWN0PihxKVxuXG4gICAgcmV0dXJuIHJvd3M7XG4gIH1cblxuICBhc3luYyBnZXRPYmplY3RzQnlJZChpZDogbnVtYmVyKSB7XG4gICAgY29uc3QgcTogVGFibGVSb3dzQXJncyA9IHtcbiAgICAgIHRhYmxlOiAnb2JqZWN0cycsXG4gICAgICBsaW1pdDogMSxcbiAgICAgIGxvd2VyX2JvdW5kOiBpZCxcbiAgICAgIHVwcGVyX2JvdW5kOiBpZCxcbiAgICAgIGluZGV4X3Bvc2l0aW9uOiAwLFxuICAgICAga2V5X3R5cGU6ICdpNjQnLFxuICAgICAgcGFyc2VNZXRhQXNKc29uOiB0cnVlLFxuICAgICAgcGFyc2VLZXlzQXNKc29uOiBbJ2ltYWdlcyddLFxuICAgICAgZGVmYXVsdEpzb25WYWx1ZXM6IHtcbiAgICAgICAgaW1hZ2VzOiAoKSA9PiBbXSxcbiAgICAgIH0sXG4gICAgfVxuICAgIGNvbnN0IHtyb3dzfSA9IGF3YWl0IHRoaXMuZ2V0VGFibGVSb3dzPE5mdE9iamVjdD4ocSlcblxuICAgIHJldHVybiByb3dzO1xuICB9XG5cbiAgYXN5bmMgZ2V0TWFya2V0KCkge1xuICAgIGNvbnN0IHE6IFRhYmxlUm93c0FyZ3MgPSB7XG4gICAgICB0YWJsZTogJ21hcmtldCcsXG4gICAgICBsaW1pdDogMTAwMCxcbiAgICAgIGxvd2VyX2JvdW5kOiAwLFxuICAgICAgZ2V0QWxsUm93czogdHJ1ZSxcbiAgICAgIHBhcnNlTWV0YUFzSnNvbjogdHJ1ZSxcbiAgICB9XG4gICAgY29uc3Qge3Jvd3N9ID0gYXdhaXQgdGhpcy5nZXRUYWJsZVJvd3M8TmZ0TWFya2V0T2JqZWN0PihxKVxuXG4gICAgcmV0dXJuIHJvd3M7XG4gIH1cblxuICBhc3luYyBnZXRNYXJrZXRPYmplY3RzQnlJZChpZDogbnVtYmVyKSB7XG4gICAgY29uc3QgcTogVGFibGVSb3dzQXJncyA9IHtcbiAgICAgIHRhYmxlOiAnbWFya2V0JyxcbiAgICAgIGxpbWl0OiAxLFxuICAgICAgbG93ZXJfYm91bmQ6IGlkLFxuICAgICAgdXBwZXJfYm91bmQ6IGlkLFxuICAgICAgaW5kZXhfcG9zaXRpb246IDAsXG4gICAgICBrZXlfdHlwZTogJ2k2NCcsXG4gICAgICBwYXJzZU1ldGFBc0pzb246IHRydWUsXG4gICAgfVxuICAgIGNvbnN0IHtyb3dzfSA9IGF3YWl0IHRoaXMuZ2V0VGFibGVSb3dzPE5mdE1hcmtldE9iamVjdD4ocSlcblxuICAgIHJldHVybiByb3dzO1xuICB9XG5cbiAgYXN5bmMgZmV0Y2hSZXF1ZXN0c1dpdGhJbmRleFBvc2l0aW9uKHVzZXJuYW1lOiBBY2NvdW50TmFtZSwgaW5kZXhQb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgY29uc3QgcTogVGFibGVSb3dzQXJncyA9IHtcbiAgICAgIHRhYmxlOiAncmVxdWVzdHMnLFxuICAgICAgbG93ZXJfYm91bmQ6IHVzZXJuYW1lLFxuICAgICAgdXBwZXJfYm91bmQ6IHVzZXJuYW1lLFxuICAgICAgbGltaXQ6IDEwMDAsXG4gICAgICBpbmRleF9wb3NpdGlvbjogaW5kZXhQb3NpdGlvbixcbiAgICAgIGtleV90eXBlOiAnaTY0JyxcbiAgICAgIHBhcnNlS2V5c0FzSnNvbjogWydkZWxpdmVyeV90bycsICdtZXRhJ10sXG4gICAgICBnZXRBbGxSb3dzOiB0cnVlLFxuICAgIH1cbiAgICBjb25zdCB7cm93c30gPSBhd2FpdCB0aGlzLmdldFRhYmxlUm93czxOZnRNYXJrZXRSZXF1ZXN0PihxKVxuXG4gICAgcmV0dXJuIHJvd3M7XG4gIH1cblxuICBhc3luYyBmZXRjaFJlcXVlc3RzKHVzZXJuYW1lOiBBY2NvdW50TmFtZSkge1xuICAgIGNvbnN0IFthc0J1eWVyLCBhc1NlbGxlcl0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLmZldGNoUmVxdWVzdHNXaXRoSW5kZXhQb3NpdGlvbih1c2VybmFtZSwgMiksXG4gICAgICB0aGlzLmZldGNoUmVxdWVzdHNXaXRoSW5kZXhQb3NpdGlvbih1c2VybmFtZSwgMyksXG4gICAgXSk7XG5cbiAgICByZXR1cm4gWy4uLmFzQnV5ZXIsIC4uLmFzU2VsbGVyXTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOZnRDb250cmFjdFxuIl19